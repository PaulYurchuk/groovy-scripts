//Variables section
def env = System.getenv()
def artifact = env['ARTIFACT_SUFFIX']
def version = env['BUILD_NUMBER']
def group = "${artifact}"
def repository = "project-releases"
def myFile = new File ("${artifact}-${version}.tar.gz").bytes
def user = "nexus-service-user"
def password = "nexus"

def urlString = "http://192.168.56.104:8081/repository/${repository}/${group}/${artifact}/${version}/${artifact}-${version}.tar.gz"
def url = new URL(urlString) 
def connection = url.openConnection() 

//Authentication section
def basicAuth = "${user}:${password}".bytes.encodeBase64().toString()

//Property section
connection.setRequestProperty("Authorization", "Basic ${basicAuth}")
connection.setRequestMethod("PUT")
connection.setRequestProperty("Content-Type", "application/gzip");


//Connect and output
connection.doOutput = true 
def writer = new DataOutputStream(connection.outputStream) 
writer.write(myFile) 
writer.flush() 
writer.close() 
connection.connect() 

//Checks
headerFields = connection.getHeaderFields() 
headerFields.each {println it} 
